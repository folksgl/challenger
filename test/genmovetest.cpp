#include "gtest/gtest.h"
#include "../src/genmove.h"
#include <string>

using namespace std;

/*
 *  Generating moves is likely the most difficult. As such, its going to recieve a little
 *  special treatment when it comes to the grouping of the tests within this file. The 
 *  tests will be grouped by move generation for specific pieces instead of the type of 
 *  tests themselves. For example, there will be one test per section checking the number
 *  of moves generated by specific call, instead of a single section for tests that check
 *  the same number.
 */

//
// START WHITE PAWN GENERATION TESTS ///////////////////////////////////////////
//

TEST(number_of_moves_generated, startpos_white_pawns) {
    std::string test = "rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR w KQkq - 0 1";
    Position startpos(test);

    generate_w_pawn_moves(&startpos);

    EXPECT_EQ (startpos.moves.size(), 16);
}

TEST(correct_moves_generated, startpos_white) {
    std::string test = "rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR w KQkq - 0 1";
    Position startpos(test);

    generate_w_pawn_moves(&startpos);
    std::sort(startpos.moves.begin(), startpos.moves.end(), 
            [](Position const &a, Position const &b) { return a.movestring < b.movestring; });

    ASSERT_EQ(startpos.moves.size(), 16);

    EXPECT_EQ(startpos.moves[0].movestring,   "a2a3");
    EXPECT_EQ(startpos.moves[1].movestring,   "a2a4");
    EXPECT_EQ(startpos.moves[2].movestring,   "b2b3");
    EXPECT_EQ(startpos.moves[3].movestring,   "b2b4");
    EXPECT_EQ(startpos.moves[4].movestring,   "c2c3");
    EXPECT_EQ(startpos.moves[5].movestring,   "c2c4");
    EXPECT_EQ(startpos.moves[6].movestring,   "d2d3");
    EXPECT_EQ(startpos.moves[7].movestring,   "d2d4");
    EXPECT_EQ(startpos.moves[8].movestring,   "e2e3");
    EXPECT_EQ(startpos.moves[9].movestring,   "e2e4");
    EXPECT_EQ(startpos.moves[10].movestring,  "f2f3");
    EXPECT_EQ(startpos.moves[11].movestring,  "f2f4");
    EXPECT_EQ(startpos.moves[12].movestring,  "g2g3");
    EXPECT_EQ(startpos.moves[13].movestring,  "g2g4");
    EXPECT_EQ(startpos.moves[14].movestring,  "h2h3");
    EXPECT_EQ(startpos.moves[15].movestring,  "h2h4");
}

TEST(correct_moves_generated, tripple_pawn_standoff_white) {
    std::string test = "rnbqkbnr/pp3ppp/8/2ppp3/2PPP3/8/PP3PPP/RNBQKBNR w KQkq - 0 1";
    Position startpos(test);

    generate_w_pawn_moves(&startpos);
    std::sort(startpos.moves.begin(), startpos.moves.end(), 
            [](Position const &a, Position const &b) { return a.movestring < b.movestring; });

    ASSERT_EQ(startpos.moves.size(), 14);

    EXPECT_EQ(startpos.moves[0].movestring,   "a2a3");
    EXPECT_EQ(startpos.moves[1].movestring,   "a2a4");
    EXPECT_EQ(startpos.moves[2].movestring,   "b2b3");
    EXPECT_EQ(startpos.moves[3].movestring,   "b2b4");
    EXPECT_EQ(startpos.moves[4].movestring,   "c4d5");
    EXPECT_EQ(startpos.moves[5].movestring,   "d4c5");
    EXPECT_EQ(startpos.moves[6].movestring,   "d4e5");
    EXPECT_EQ(startpos.moves[7].movestring,   "e4d5");
    EXPECT_EQ(startpos.moves[8].movestring,   "f2f3");
    EXPECT_EQ(startpos.moves[9].movestring,   "f2f4");
    EXPECT_EQ(startpos.moves[10].movestring,  "g2g3");
    EXPECT_EQ(startpos.moves[11].movestring,  "g2g4");
    EXPECT_EQ(startpos.moves[12].movestring,  "h2h3");
    EXPECT_EQ(startpos.moves[13].movestring,  "h2h4");
}

TEST(capture_passant, white) {
    std::string test = "rnbqkbnr/ppp1pppp/8/2Pp4/8/8/PP1PPPPP/RNBQKBNR w KQkq d6 0 1";
    Position startpos(test);

    generate_w_pawn_moves(&startpos);
    std::sort(startpos.moves.begin(), startpos.moves.end(), 
            [](Position const &a, Position const &b) { return a.movestring < b.movestring; });

    ASSERT_EQ(startpos.moves.size(), 16);

    EXPECT_EQ(startpos.moves[0].movestring,   "a2a3");
    EXPECT_EQ(startpos.moves[1].movestring,   "a2a4");
    EXPECT_EQ(startpos.moves[2].movestring,   "b2b3");
    EXPECT_EQ(startpos.moves[3].movestring,   "b2b4");
    EXPECT_EQ(startpos.moves[4].movestring,   "c5c6");
    EXPECT_EQ(startpos.moves[5].movestring,   "c5d6");
    EXPECT_EQ(startpos.moves[6].movestring,   "d2d3");
    EXPECT_EQ(startpos.moves[7].movestring,   "d2d4");
    EXPECT_EQ(startpos.moves[8].movestring,   "e2e3");
    EXPECT_EQ(startpos.moves[9].movestring,   "e2e4");
    EXPECT_EQ(startpos.moves[10].movestring,  "f2f3");
    EXPECT_EQ(startpos.moves[11].movestring,  "f2f4");
    EXPECT_EQ(startpos.moves[12].movestring,  "g2g3");
    EXPECT_EQ(startpos.moves[13].movestring,  "g2g4");
    EXPECT_EQ(startpos.moves[14].movestring,  "h2h3");
    EXPECT_EQ(startpos.moves[15].movestring,  "h2h4");

}

//
// START BLACK PAWN GENERATION TESTS ///////////////////////////////////////////
//

TEST(number_of_moves_generated, startpos_black_pawns) {
    std::string test = "rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR b KQkq - 0 1";
    Position startpos(test);

    generate_b_pawn_moves(&startpos);

    EXPECT_EQ (startpos.moves.size(), 16);
}

TEST(correct_moves_generated, startpos_black) {
    std::string test = "rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR w KQkq - 0 1";
    Position startpos(test);

    generate_b_pawn_moves(&startpos);
    std::sort(startpos.moves.begin(), startpos.moves.end(), 
            [](Position const &a, Position const &b) { return a.movestring < b.movestring; });

    ASSERT_EQ(startpos.moves.size(), 16);

    EXPECT_EQ(startpos.moves[0].movestring,   "a7a5");
    EXPECT_EQ(startpos.moves[1].movestring,   "a7a6");
    EXPECT_EQ(startpos.moves[2].movestring,   "b7b5");
    EXPECT_EQ(startpos.moves[3].movestring,   "b7b6");
    EXPECT_EQ(startpos.moves[4].movestring,   "c7c5");
    EXPECT_EQ(startpos.moves[5].movestring,   "c7c6");
    EXPECT_EQ(startpos.moves[6].movestring,   "d7d5");
    EXPECT_EQ(startpos.moves[7].movestring,   "d7d6");
    EXPECT_EQ(startpos.moves[8].movestring,   "e7e5");
    EXPECT_EQ(startpos.moves[9].movestring,   "e7e6");
    EXPECT_EQ(startpos.moves[10].movestring,  "f7f5");
    EXPECT_EQ(startpos.moves[11].movestring,  "f7f6");
    EXPECT_EQ(startpos.moves[12].movestring,  "g7g5");
    EXPECT_EQ(startpos.moves[13].movestring,  "g7g6");
    EXPECT_EQ(startpos.moves[14].movestring,  "h7h5");
    EXPECT_EQ(startpos.moves[15].movestring,  "h7h6");
}

TEST(correct_moves_generated, tripple_pawn_standoff_black) {
    std::string test = "rnbqkbnr/pp3ppp/8/2ppp3/2PPP3/8/PP3PPP/RNBQKBNR b KQkq - 0 1";
    Position startpos(test);

    generate_b_pawn_moves(&startpos);
    std::sort(startpos.moves.begin(), startpos.moves.end(), 
            [](Position const &a, Position const &b) { return a.movestring < b.movestring; });

    ASSERT_EQ(startpos.moves.size(), 14);

    EXPECT_EQ(startpos.moves[0].movestring,   "a7a5");
    EXPECT_EQ(startpos.moves[1].movestring,   "a7a6");
    EXPECT_EQ(startpos.moves[2].movestring,   "b7b5");
    EXPECT_EQ(startpos.moves[3].movestring,   "b7b6");
    EXPECT_EQ(startpos.moves[4].movestring,   "c5d4");
    EXPECT_EQ(startpos.moves[5].movestring,   "d5c4");
    EXPECT_EQ(startpos.moves[6].movestring,   "d5e4");
    EXPECT_EQ(startpos.moves[7].movestring,   "e5d4");
    EXPECT_EQ(startpos.moves[8].movestring,   "f7f5");
    EXPECT_EQ(startpos.moves[9].movestring,   "f7f6");
    EXPECT_EQ(startpos.moves[10].movestring,  "g7g5");
    EXPECT_EQ(startpos.moves[11].movestring,  "g7g6");
    EXPECT_EQ(startpos.moves[12].movestring,  "h7h5");
    EXPECT_EQ(startpos.moves[13].movestring,  "h7h6");
}

TEST(capture_passant, black) {
    std::string test = "rnbqkbnr/pp1ppppp/8/8/2pP4/8/PP2PPPP/RNBQKBNR b KQkq d3 0 1";
    Position startpos(test);

    generate_b_pawn_moves(&startpos);
    std::sort(startpos.moves.begin(), startpos.moves.end(), 
            [](Position const &a, Position const &b) { return a.movestring < b.movestring; });

    ASSERT_EQ(startpos.moves.size(), 16);

    EXPECT_EQ(startpos.moves[0].movestring,   "a7a5");
    EXPECT_EQ(startpos.moves[1].movestring,   "a7a6");
    EXPECT_EQ(startpos.moves[2].movestring,   "b7b5");
    EXPECT_EQ(startpos.moves[3].movestring,   "b7b6");
    EXPECT_EQ(startpos.moves[4].movestring,   "c4c3");
    EXPECT_EQ(startpos.moves[5].movestring,   "c4d3");
    EXPECT_EQ(startpos.moves[6].movestring,   "d7d5");
    EXPECT_EQ(startpos.moves[7].movestring,   "d7d6");
    EXPECT_EQ(startpos.moves[8].movestring,   "e7e5");
    EXPECT_EQ(startpos.moves[9].movestring,   "e7e6");
    EXPECT_EQ(startpos.moves[10].movestring,  "f7f5");
    EXPECT_EQ(startpos.moves[11].movestring,  "f7f6");
    EXPECT_EQ(startpos.moves[12].movestring,  "g7g5");
    EXPECT_EQ(startpos.moves[13].movestring,  "g7g6");
    EXPECT_EQ(startpos.moves[14].movestring,  "h7h5");
    EXPECT_EQ(startpos.moves[15].movestring,  "h7h6");

}

//
// START WHITE KNIGHT GENERATION TESTS /////////////////////////////////////////
//

TEST(number_of_moves_generated, startpos_white_knight) {
    std::string test = "rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR w KQkq - 0 1";
    Position startpos(test);

    generate_w_knight_moves(&startpos);

    EXPECT_EQ (startpos.moves.size(), 4);
}

//
// START BLACK KNIGHT GENERATION TESTS /////////////////////////////////////////
//

TEST(number_of_moves_generated, startpos_black_knight) {
    std::string test = "rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR b KQkq - 0 1";
    Position startpos(test);

    generate_b_knight_moves(&startpos);

    EXPECT_EQ (startpos.moves.size(), 4);
}

//
// START WHITE BISHOP GENERATION TESTS ///////////////////////////////////////////
//

TEST(number_of_moves_generated, startpos_white_bishop) {
    std::string test = "rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR w KQkq - 0 1";
    Position startpos(test);

    generate_w_bishop_moves(&startpos);

    EXPECT_EQ (startpos.moves.size(), 0);
}

//
// START BLACK BISHOP GENERATION TESTS ///////////////////////////////////////////
//

TEST(number_of_moves_generated, startpos_black_bishop) {
    std::string test = "rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR b KQkq - 0 1";
    Position startpos(test);

    generate_b_bishop_moves(&startpos);

    EXPECT_EQ (startpos.moves.size(), 0);
}

//
// START WHITE ROOK GENERATION TESTS ///////////////////////////////////////////
//

TEST(number_of_moves_generated, startpos_white_rook) {
    std::string test = "rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR w KQkq - 0 1";
    Position startpos(test);

    generate_w_rook_moves(&startpos);

    EXPECT_EQ (startpos.moves.size(), 0);
}

//
// START BLACK ROOK GENERATION TESTS ///////////////////////////////////////////
//

TEST(number_of_moves_generated, startpos_black_rook) {
    std::string test = "rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR b KQkq - 0 1";
    Position startpos(test);

    generate_b_rook_moves(&startpos);

    EXPECT_EQ (startpos.moves.size(), 0);
}

//
// START WHITE QUEEN GENERATION TESTS ///////////////////////////////////////////
//

TEST(number_of_moves_generated, startpos_white_queen) {
    std::string test = "rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR w KQkq - 0 1";
    Position startpos(test);

    generate_w_queen_moves(&startpos);

    EXPECT_EQ (startpos.moves.size(), 0);
}

//
// START BLACK QUEEN GENERATION TESTS ///////////////////////////////////////////
//

TEST(number_of_moves_generated, startpos_black_queen) {
    std::string test = "rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR b KQkq - 0 1";
    Position startpos(test);

    generate_b_queen_moves(&startpos);

    EXPECT_EQ (startpos.moves.size(), 0);
}

//
// START WHITE KING GENERATION TESTS ///////////////////////////////////////////
//

TEST(number_of_moves_generated, startpos_white_king) {
    std::string test = "rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR w KQkq - 0 1";
    Position startpos(test);

    generate_w_king_moves(&startpos);

    EXPECT_EQ (startpos.moves.size(), 0);
}

//
// START BLACK KING GENERATION TESTS ///////////////////////////////////////////
//

TEST(number_of_moves_generated, startpos_black_king) {
    std::string test = "rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR b KQkq - 0 1";
    Position startpos(test);

    generate_b_king_moves(&startpos);

    EXPECT_EQ (startpos.moves.size(), 0);
}

